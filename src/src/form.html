<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro - Diaristas</title>
    <script>
        async function submitForm(event) {
            event.preventDefault();

            // Capturando os dados do formulário
            const name = document.getElementById("name").value;
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;
            const street = document.getElementById("street").value;
            const city = document.getElementById("city").value;
            const state = document.getElementById("state").value;
            const zip_code = document.getElementById("zip_code").value;
            const userType = document.querySelector('input[name="userType"]:checked').value;
            const planId = document.getElementById("plan").value;

            try {
                // 1. Criando o usuário
                let response = await fetch("http://localhost:3000/api/users", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ name, email, password })
                });
                let user = await response.json();
                console.log("Usuário criado:", user);

                // 2. Criando o endereço
                response = await fetch("http://localhost:3000/api/addresses", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        user_id: user.id,
                        street,
                        city,
                        state,
                        zip_code
                    })
                });
                let address = await response.json();
                console.log("Endereço criado:", address);

                // 3. Criando a assinatura do plano
                response = await fetch("http://localhost:3000/api/subscriptions", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        user_id: user.id,
                        plan_id: parseInt(planId)
                    })
                });
                let subscription = await response.json();
                console.log("Assinatura criada:", subscription);

                alert("Cadastro realizado com sucesso!");
            } catch (error) {
                console.error("Erro ao cadastrar:", error);
                alert("Erro ao cadastrar. Veja o console.");
            }
        }
    </script>
</head>
<body>
    <h2>Cadastro de Usuário</h2>
    <form onsubmit="submitForm(event)">
        <h3>Dados Pessoais</h3>
        <label>Nome:</label>
        <input type="text" id="name" required><br>

        <label>Email:</label>
        <input type="email" id="email" required><br>

        <label>Senha:</label>
        <input type="password" id="password" required><br>

        <h3>Endereço</h3>
        <label>Rua:</label>
        <input type="text" id="street" required><br>

        <label>Cidade:</label>
        <input type="text" id="city" required><br>

        <label>Estado:</label>
        <input type="text" id="state" required><br>

        <label>CEP:</label>
        <input type="text" id="zip_code" required><br>

        <h3>Tipo de Conta</h3>
        <input type="radio" id="cliente" name="userType" value="cliente" checked>
        <label for="cliente">Cliente</label>

        <input type="radio" id="diarista" name="userType" value="diarista">
        <label for="diarista">Diarista</label>

        <h3>Escolha o Plano</h3>
        <select id="plan">
            <option value="1">Gratuito</option>
            <option value="2">Básico (R$ 49,90)</option>
            <option value="3">Premium (R$ 99,90)</option>
        </select>

        <br><br>
        <button type="submit">Cadastrar</button>
    </form>
</body>
</html>
